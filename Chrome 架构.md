# Chrome 架构



以 Chrome 架构来展开对市面上浏览器架构的分析



## 进程与线程

* 进程是 OS 分配资源的最小单位，线程是 CPU 执行的最小单位。可以看作进程中可以有多个线程
* 进程有完整的资源平台，同一进程内的线程是共享资源的例如进程中的代码、数据等。线程只独立拥有自己的寄存器，堆栈。
* 多线程相对于单线程来说多线程可以进行多任务的并发执行，例如 IO 等耗时任务可以很好的进行处理，效率高于单线程
* 进程之间的数据是相互隔离的



![image-20220419115815552](https://typora-1300781048.cos.ap-beijing.myqcloud.com/img/202204191158600.png)

![img](https://typora-1300781048.cos.ap-beijing.myqcloud.com/img/202204191156663.png)





## 架构发展

整体的架构发展：

* 单进程架构

  

* 



## 单进程多线程架构

由于早期的 os 是单用户单任务的，所以不能并发执行进程

单进程多线程架构即将所有的内容包括网络、插件、JS 执行环境都集成到这个进程中。插件、JS 执行、渲染引擎模块处于同一线程，另外还有 GPU 线程、网络请求进程等

正因为架构所以存在几个问题：



### 不稳定

根本原因由于进程内的某一线程出现崩溃就会导致整个进程崩溃

与此同时插件以及引擎渲染模块是不稳定的容易崩溃

### 不流畅

由于所有页面的渲染模块引擎都在一个线程，这就导致同一时刻只有一个模块可以运行，如果代码/插件中出现类似以下的执行时间非常长的代码就会导致页面没有响应

```js
function freeze() {
  while (1) {
    console.log("freeze");
  }
}
freeze();
```

同时还存在内存泄漏会导致单进程变慢，即允许一个复杂的页面会导致部分内存没有被回收，这样就会导致时间使用越长，内存占比越高，浏览器就变得越慢

### 不安全

插件/页面脚本可以通过浏览器漏洞获取操作系统权限就可以获取到资源文件



