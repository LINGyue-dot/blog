# Nodejs 并发



## 为什么适合高并发

Nodejs 适合高并发场景，本质上这里的高并发指的是 TCP 连接数目

一般的后端服务分为

* 通信层，负责 socket 连接的创建和管理，负责 bind/listen 等
* 业务逻辑层



通信层

* 都是 IO 行为，不怎么消耗 CPU

业务层

* 少量 CPU 消耗，大部分事件再等待数据库或者 rpc 返回



一般来说 TCP 连接数为 10K ，实际的每秒请求数目 qps 可能才 100 ，所以如果用多线程模型的话，一个 TCP 连接对应一个线程，那么开销就很大了。

而对于 Nodejs 的事件驱动模型来说，有 100 个请求时候，核心处理的只有单线程，要处理时候是将 100 个请求一个个拿出来按照事件循环来进行执行的。

Nodejs 的高效 IO ，但是对于多核利用上较为一般（可以用 C++ 模块 `cluster` ）



## BFF 层

所谓的中间层

一般做的工作

* 数据的处理，参数名修改，构造成符合前端的数据结构
* 接口聚合，rpc ，让后端提供基础服务







## nginx

nginx 就是负责通信层，让业务逻辑层由具体的后端服务负责



## 参考

https://zhuanlan.zhihu.com/p/147020965

https://www.zhihu.com/search?type=content&q=BFF%20nodejs